<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Portfolio</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚡️</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background: #1a1b26;
            --foreground: #c0caf5;
            --primary: #bb9af7;
            --secondary: #7aa2f7;
            --accent: #f7768e;
            --border: #414868;
            --font-family: 'Fira Code', monospace;
            --font-size: 16px;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        body {
            background-color: var(--background);
            color: var(--foreground);
            font-family: var(--font-family);
            font-size: var(--font-size);
            line-height: 1.6;
        }

        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.5;
        }

        #terminal-container {
            position: relative;
            z-index: 1;
            height: 100%;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            scrollbar-width: none; /* Firefox */
        }
        #terminal-container::-webkit-scrollbar {
            display: none; /* Safari and Chrome */
        }

        #output {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .input-line {
            display: flex;
            align-items: center;
        }

        .prompt {
            color: var(--primary);
            margin-right: 8px;
            white-space: nowrap;
        }

        #input-field {
            background: none;
            border: none;
            color: var(--foreground);
            font-family: var(--font-family);
            font-size: inherit;
            flex-grow: 1;
            padding: 0;
        }

        #input-field:focus {
            outline: none;
        }

        a {
            color: var(--secondary);
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }

        .command-output {
            margin-bottom: 10px;
        }
        
        .help-command {
            color: var(--primary);
            font-weight: 500;
            width: 120px;
            display: inline-block;
        }

        .ascii-art {
            color: var(--accent);
            white-space: pre;
            font-size: 14px;
            line-height: 1.2;
            text-shadow: 0 0 5px var(--accent);
            letter-spacing: -1px;
        }
        
        @media (prefers-reduced-motion: reduce) {
            .ascii-art {
                text-shadow: none;
            }
        }
        
        .game-container {
            border: 1px solid var(--border);
            padding: 1rem;
            margin-top: 1rem;
            position: relative;
            overflow: hidden;
        }

        #type-racer-text {
            color: var(--secondary);
            user-select: none;
        }

        #asteroid-dodge-screen {
            width: 100%;
            height: 200px;
            background-color: rgba(0,0,0,0.2);
            cursor: none;
            position: relative;
            overflow: hidden;
            font-family: monospace;
        }

        .player {
            position: absolute;
            color: var(--primary);
            font-size: 18px;
            user-select: none;
        }

        .asteroid {
            position: absolute;
            color: var(--accent);
            font-size: 16px;
        }
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>
    <div id="terminal-container" onclick="document.getElementById('input-field').focus();">
        <div id="output"></div>
        <div class="input-line">
            <span class="prompt">guest@portfolio:~$</span>
            <input type="text" id="input-field" autofocus autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const output = document.getElementById('output');
            const inputField = document.getElementById('input-field');
            const terminalContainer = document.getElementById('terminal-container');

            let commandHistory = [];
            let historyIndex = -1;
            let activeGame = null;

            const print = (html, isCommandOutput = false) => {
                const line = document.createElement('div');
                if (isCommandOutput) {
                    line.classList.add('command-output');
                }
                line.innerHTML = html;
                output.appendChild(line);
                terminalContainer.scrollTop = terminalContainer.scrollHeight;
            };

            const printCommand = (command) => {
                const line = `<div class="input-line"><span class="prompt">guest@portfolio:~$</span><span>${command}</span></div>`;
                print(line);
            };
            
            const commands = {
                help: {
                    description: 'Lists all available commands.',
                    action: () => {
                        let helpText = 'Available commands:<br>';
                        Object.keys(commands).sort().forEach(cmd => {
                            helpText += `<span class="help-command">${cmd}</span> - ${commands[cmd].description}<br>`;
                        });
                        return helpText;
                    }
                },
                about: {
                    description: 'Displays information about me.',
                    action: () => 'Senior front-end engineer specializing in premium, performant single-page applications.<br>I craft immersive digital experiences with Swiss grid typography, Three.js visuals, and fluid motion design.'
                },
                social: {
                    description: 'Lists my social media profiles.',
                    action: () => `
                        <a href="#" target="_blank">GitHub</a>
                        <a href="#" target="_blank">LinkedIn</a>
                        <a href="#" target="_blank">Twitter</a>
                    `.trim()
                },
                projects: {
                    description: 'Shows my featured projects.',
                    action: () => `
                        Project Alpha - Interactive WebGL data visualization.<br>
                        Project Beta - Headless CMS-driven e-commerce platform.<br>
                        Project Gamma - Award-winning marketing site with scroll-driven animations.
                    `.trim()
                },
                theme: {
                    description: 'Changes the terminal color scheme. Usage: theme [name]',
                    action: (args) => {
                        const themes = {
                            default: {
                                '--background': '#1a1b26',
                                '--foreground': '#c0caf5',
                                '--primary': '#bb9af7',
                                '--secondary': '#7aa2f7',
                                '--accent': '#f7768e',
                                '--border': '#414868',
                            },
                            'aurora-drift': {
                                '--background': '#011926',
                                '--foreground': '#E0FFFA',
                                '--primary': '#247b7b',
                                '--secondary': '#88D9E6',
                                '--accent': '#F2B705',
                                '--border': '#023859',
                            },
                            'mono-noir': {
                                '--background': '#101010',
                                '--foreground': '#d0d0d0',
                                '--primary': '#f0f0f0',
                                '--secondary': '#a0a0a0',
                                '--accent': '#ffffff',
                                '--border': '#444444',
                            }
                        };
                        
                        if (!args.length) {
                             return `Available themes: ${Object.keys(themes).join(', ')}<br>Usage: theme [name]`;
                        }

                        const themeName = args.toLowerCase();
                        if (themes[themeName]) {
                            const theme = themes[themeName];
                            for (const [key, value] of Object.entries(theme)) {
                                document.documentElement.style.setProperty(key, value);
                            }
                            return `Theme set to '${themeName}'.`;
                        }
                        return `Error: Theme '${themeName}' not found.`;
                    }
                },
                history: {
                    description: 'Shows command history.',
                    action: () => commandHistory.map((cmd, i) => `${i}: ${cmd}`).join('<br>')
                },
                clear: {
                    description: 'Clears the terminal screen.',
                    action: () => {
                        output.innerHTML = '';
                        return '';
                    }
                },
                ascii_mood: {
                    description: 'Displays a chill ASCII art portrait.',
                    action: () => {
                         const art = `
    _   _
   (o_o)
  /|   |\\
 / |   | \\
/  |   |  \\
   |   |
   |   |
  /     \\
 /       \\
                        `;
                        return `<div class="ascii-art">${art}</div>`;
                    }
                },
                'type-racer': {
                    description: 'Starts a timed typing challenge.',
                    action: () => {
                        if (activeGame) return 'Another game is already running. Please exit it first.';
                        activeGame = 'type-racer';
                        const sentences = [
                            "The quick brown fox jumps over the lazy dog.",
                            "Swiss grid typography balances structure and creativity.",
                            "Three.js unlocks the power of 3D graphics on the web.",
                            "Performance-minded loading is crucial for user experience.",
                            "Semantic HTML5 enhances accessibility and SEO.",
                        ];
                        const sentence = sentences[Math.floor(Math.random() * sentences.length)];
                        let startTime;
                        
                        const gameContainer = document.createElement('div');
                        gameContainer.className = 'game-container';
                        
                        const textDisplay = document.createElement('div');
                        textDisplay.id = 'type-racer-text';
                        textDisplay.innerHTML = sentence.split('').map(char => `<span>${char}</span>`).join('');
                        
                        const instructions = document.createElement('div');
                        instructions.textContent = 'Type the text above. The timer starts on your first keystroke. Type "exit" to quit.';
                        instructions.style.marginTop = '10px';
                        instructions.style.fontSize = '0.9em';

                        gameContainer.appendChild(textDisplay);
                        gameContainer.appendChild(instructions);
                        output.appendChild(gameContainer);
                        terminalContainer.scrollTop = terminalContainer.scrollHeight;

                        let currentIndex = 0;
                        const spans = textDisplay.querySelectorAll('span');

                        const gameInputHandler = (e) => {
                            if (e.key === 'Enter') {
                                const currentInput = inputField.value.trim();
                                if (currentInput.toLowerCase() === 'exit') {
                                    endGame();
                                    return;
                                }
                            }
                            if (e.key.length > 1) return; // Ignore control keys

                            if (!startTime) {
                                startTime = new Date();
                            }
                            
                            const expectedChar = sentence[currentIndex];
                            const typedChar = e.key;
                            
                            if (typedChar === expectedChar) {
                                spans[currentIndex].style.color = 'var(--primary)';
                                currentIndex++;
                            } else {
                                spans[currentIndex].style.color = 'var(--accent)';
                            }

                            if (currentIndex === sentence.length) {
                                const endTime = new Date();
                                const duration = (endTime - startTime) / 1000; // in seconds
                                const words = sentence.split(' ').length;
                                const wpm = Math.round((words / duration) * 60);
                                print(`</br>Congratulations! Your WPM: <strong>${wpm}</strong>`);
                                endGame();
                            }
                        };
                        
                        const endGame = () => {
                            inputField.removeEventListener('keydown', gameInputHandler);
                            inputField.value = '';
                            printCommand('');
                            activeGame = null;
                        };
                        
                        inputField.addEventListener('keydown', gameInputHandler);
                        return 'Type Racer started. Focus the input below and start typing.';
                    }
                },
                'asteroid-dodge': {
                    description: 'Starts a cursor-controlled avoidance mini-game.',
                    action: () => {
                        if (activeGame) return 'Another game is already running. Please exit it first.';
                        activeGame = 'asteroid-dodge';
                        
                        const gameContainer = document.createElement('div');
                        gameContainer.className = 'game-container';
                        const screen = document.createElement('div');
                        screen.id = 'asteroid-dodge-screen';
                        
                        const instructions = document.createElement('div');
                        instructions.textContent = 'Move your mouse to dodge the asteroids. Type "exit" to quit.';
                        instructions.style.fontSize = '0.9em';
                        
                        gameContainer.appendChild(instructions);
                        gameContainer.appendChild(screen);
                        output.appendChild(gameContainer);
                        terminalContainer.scrollTop = terminalContainer.scrollHeight;

                        const player = document.createElement('div');
                        player.textContent = 'A';
                        player.className = 'player';
                        screen.appendChild(player);

                        let score = 0;
                        let gameLoop;
                        let gameOver = false;
                        
                        const screenRect = screen.getBoundingClientRect();

                        const mouseMoveHandler = (e) => {
                            if (gameOver) return;
                            let playerX = e.clientX - screenRect.left - 10;
                            let playerY = e.clientY - screenRect.top - 10;
                            playerX = Math.max(0, Math.min(screenRect.width - 20, playerX));
                            playerY = Math.max(0, Math.min(screenRect.height - 20, playerY));
                            player.style.left = `${playerX}px`;
                            player.style.top = `${playerY}px`;
                        };
                        screen.addEventListener('mousemove', mouseMoveHandler);

                        const update = () => {
                            if (gameOver) return;
                            
                            // Create new asteroids
                            if (Math.random() < 0.1) {
                                const asteroid = document.createElement('div');
                                asteroid.textContent = '*';
                                asteroid.className = 'asteroid';
                                asteroid.style.left = `${Math.random() * screenRect.width}px`;
                                asteroid.style.top = `-10px`;
                                screen.appendChild(asteroid);
                            }

                            // Move asteroids and check for collisions
                            const asteroids = screen.querySelectorAll('.asteroid');
                            const playerRect = player.getBoundingClientRect();
                            
                            asteroids.forEach(asteroid => {
                                const currentTop = parseFloat(asteroid.style.top);
                                asteroid.style.top = `${currentTop + 3}px`;

                                if (currentTop > screenRect.height) {
                                    asteroid.remove();
                                    score++;
                                }
                                
                                const asteroidRect = asteroid.getBoundingClientRect();
                                if (
                                    playerRect.left < asteroidRect.right &&
                                    playerRect.right > asteroidRect.left &&
                                    playerRect.top < asteroidRect.bottom &&
                                    playerRect.bottom > asteroidRect.top
                                ) {
                                    endGame(true);
                                }
                            });
                            
                            gameLoop = requestAnimationFrame(update);
                        };

                        const inputHandler = (e) => {
                           if (e.key === 'Enter' && inputField.value.trim().toLowerCase() === 'exit') {
                               endGame(false);
                           }
                        };
                        
                        const endGame = (crashed) => {
                            gameOver = true;
                            cancelAnimationFrame(gameLoop);
                            screen.removeEventListener('mousemove', mouseMoveHandler);
                            inputField.removeEventListener('keydown', inputHandler);
                            inputField.value = '';

                            if (crashed) {
                                player.textContent = 'X';
                                player.style.color = 'var(--accent)';
                                print(`</br>Game Over! Final Score: ${score}`);
                            } else {
                                print(`</br>Game exited. Final Score: ${score}`);
                            }
                            printCommand('');
                            activeGame = null;
                        };
                        
                        inputField.addEventListener('keydown', inputHandler);
                        gameLoop = requestAnimationFrame(update);
                        return 'Asteroid Dodge started. Move your mouse in the box above.';
                    }
                }
            };

            const runCommand = (commandStr) => {
                printCommand(commandStr);
                commandHistory.unshift(commandStr);
                if (commandHistory.length > 50) commandHistory.pop();
                historyIndex = -1;

                const [cmd, ...args] = commandStr.trim().split(/\s+/);

                if (commands[cmd]) {
                    const result = commands[cmd].action(args);
                    if (result) print(result, true);
                } else if (cmd) {
                    print(`Command not found: ${cmd}. Type 'help' for a list of commands.`, true);
                }
                
                // Reset input value only if not in a game that uses it
                if (!activeGame) {
                    inputField.value = '';
                }
                
            };

            inputField.addEventListener('keydown', (e) => {
                if (activeGame) return; // Let game handlers take control

                if (e.key === 'Enter') {
                    e.preventDefault();
                    runCommand(inputField.value);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (historyIndex < commandHistory.length - 1) {
                        historyIndex++;
                        inputField.value = commandHistory[historyIndex];
                        setTimeout(() => inputField.setSelectionRange(inputField.value.length, inputField.value.length), 0);
                    }
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (historyIndex > 0) {
                        historyIndex--;
                        inputField.value = commandHistory[historyIndex];
                        setTimeout(() => inputField.setSelectionRange(inputField.value.length, inputField.value.length), 0);
                    } else {
                        historyIndex = -1;
                        inputField.value = '';
                    }
                } else if (e.key === 'Tab') {
                    e.preventDefault();
                    // Autocomplete logic could go here
                }
            });

            const welcomeMessage = `
Welcome to my interactive portfolio.
Type 'help' to see the list of available commands.
            `;
            print(welcomeMessage, true);
            
            // --- Three.js Background ---
            let scene, camera, renderer, stars;

            function initThreeJS() {
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
                camera.position.z = 1;
                camera.rotation.x = Math.PI / 2;

                renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bg-canvas'), alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);

                const starGeo = new THREE.BufferGeometry();
                const starCount = 6000;
                const positions = new Float32Array(starCount * 3);
                for (let i = 0; i < starCount * 3; i++) {
                    positions[i] = (Math.random() - 0.5) * 600;
                }
                starGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                
                let starMaterial = new THREE.PointsMaterial({
                    color: 0xaaaaaa,
                    size: 0.7,
                    transparent: true
                });

                stars = new THREE.Points(starGeo, starMaterial);
                scene.add(stars);

                window.addEventListener('resize', onWindowResize, false);
                animate();
            }

            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }

            function animate() {
                stars.rotation.y += 0.0002;
                renderer.render(scene, camera);
                requestAnimationFrame(animate);
            }
            
            if (window.matchMedia && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                initThreeJS();
            }
        });
    </script>
</body>
</html>